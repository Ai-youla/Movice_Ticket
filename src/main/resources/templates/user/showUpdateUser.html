<!-- <!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>修改用户信息</title>
</head>
<body>
 <form th:action="@{'/admin/updateUser'}" enctype="multipart/form-data" method="post">
       <table>
           <tr>
           <td> <img  style="width:100px;" alt="404" th:src="@{'/UserIMAGE/'+${user.picture }}"></td>
              <td>用户名</td>
              <td><input type="text" name="userName" th:value="${user.userName}"></td>
           </tr>
           <tr>
              <td>密码</td>
              <td><input type="text" name="userPassword" th:value="${user.userPassword}"></td>
           </tr> 
          <tr>
          	<td>
          	 <input type="hidden" id="phone" name="userId" th:value="${user.userId}"  >
          	  <input type="email" id="email" name="email" th:value="${user.email}"   placeholder="电子邮件" >
	        <input type="text" id="phone" name="phone" th:value="${user.phone}"   placeholder="电话号码" >
	        <input type="text" id="address" name="address"  th:value="${user.address}" placeholder="联系地址" >
          	</td>
          </tr>      
   
           <tr>
              <td colspan="2">
                 <input type="submit" value="确定">
                 <a th:href="@{'/admin/showUpdatePicture?userId='+${user.userId}}">修改头像</a>
              </td>
           </tr>        
       </table>
   </form>
</body>
</html> -->
<!DOCTYPE html>
<html class="iframe-h" xmlns:th="http://www.thymeleaf.org">

	<head>
		<meta charset="UTF-8">
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>编辑用户信息</title>
		<link rel="stylesheet" type="text/css" href="/layui/css/layui.css" />
		<link rel="stylesheet" type="text/css" href="/css/admin.css" />
		
	</head>

	<body>
		<div class="layui-tab page-content-wrap">
		  <ul class="layui-tab-title">
		    <li class="layui-this">编辑用户信息</li> 
		    <li >修改用户头像</li> 
		  </ul>
		  <div class="layui-tab-content">
		    <div class="layui-tab-item layui-show">
					 <form class="layui-form" th:action="@{'/admin/updateUser'}"  enctype="multipart/form-data" method="post"  style="width: 90%;padding-top: 20px;">
				  		  
					  <div class="layui-form-item">
					    <label class="layui-form-label">头像：</label>
					    <div class="layui-input-block">
					    <img  style="width:100px;" alt="404" th:src="@{'/UserIMAGE/'+${user.picture }}"> 
					     <input type="hidden"   name="userId" th:value="${user.userId}"  >
					    </div>
					  </div>
					   
					  <div class="layui-form-item">
					    <label class="layui-form-label">用户名：</label>
					    <div class="layui-input-block">
					      <input type="text" name="userName" th:value="${user.userName}" required  lay-verify="required" placeholder="请输入"   class="layui-input"  >
					    </div>
					  </div>
					   <div class="layui-form-item">
					    <label class="layui-form-label">密码：</label>
					    <div class="layui-input-block">
					      <input type="text"  name="userPassword" th:value="${user.userPassword}" required  lay-verify="required" placeholder="请输入"   class="layui-input"  >
					    </div>
					  </div>
					  <div class="layui-form-item">
						<label class="layui-form-label">邮件：</label>
							<div class="layui-input-block">
									<input type="text"   name="email" th:value="${user.email}" required   placeholder="请输入"   class="layui-input"  >
							</div>
						</div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">电话：</label>
					    <div class="layui-input-block">
					      <input type="text"  name="phone" th:value="${user.phone}"  required  lay-verify="required" placeholder="请输入"   class="layui-input"  >
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <label class="layui-form-label">联系地址：</label>
					    <div class="layui-input-block">
					      <input type="text" id="address" name="address"  th:value="${user.address}"   required  lay-verify="required" placeholder="请输入"   class="layui-input"  >
					    </div>
					  </div>
					  <div class="layui-form-item">
					    <div class="layui-input-block">
					      <input type="submit" class="layui-btn layui-btn-normal"  value="立即提交 ">
					       <a class="layui-btn layui-btn-normal" th:href="@{'/admin/ListUser'}">返回</a>
					    </div>
					  </div>
				</form>
				</div>
				<div class="layui-tab-item">
		    	 	<form class="layui-form" th:action="@{'/admin/updateUserPicture'}" id="upphoto" enctype="multipart/form-data" method="post" >
						 <div class="layui-form-item">
						    <label class="layui-form-label">头像：</label>
						    <div class="layui-input-block">
						    	 <img  style="width:100px;" alt="404" th:src="@{'/UserIMAGE/'+${user.picture }}">
        						 <input type="hidden" name="userId" id="uid" th:value="${user.userId }"/>
						     </div>
						  </div>
						  <div class="layui-form-item">
						    <label class="layui-form-label">新头像：</label>
						    <div class="layui-input-block">
<!--						      // <input type="file" name="UserPicture" required  lay-verify="required"  autocomplete="off" class="layui-input " >-->
								<img id="imgData"  style="width:100px;"  alt="没有头像" >
								<input type="hidden"  id="pName"/>
								<input type="file" name="UserPicture" required  id="photofile"  onchange="postData()" class="layui-input">

							</div>
						  </div>
						  <div class="layui-form-item">
						    <div class="layui-input-block">
						      <input type="submit" id="submit" class="layui-btn layui-btn-normal" onclick="sut()"  value="立即提交 ">
						      <a class="layui-btn layui-btn-normal" th:href="@{'/admin/ListUser'}">返回</a>
						    </div>
						  </div>  
					</form>
		    	</div>
			</div>
		</div>
		<script src="/layui/layui.js" type="text/javascript" charset="utf-8"></script>
		<script src="/js/common.js" type="text/javascript" charset="utf-8"></script>
		<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
	</body>
<script>
	function postData(){
		var formData = new FormData($("#upphoto")[0]);
		formData.append('photo',document.getElementById('photofile').files[0]);
		$.ajax({
			url:'/updatephoto',
			type:"post",
			data:formData,
			contentType: false,
			processData: false,
			success:function(data){
				if (data.type == "success") {
					$("#imgData").attr("src",'/UserIMAGE/'+data.fileName);
					$("#pName").val(data.fileName);
				} else {
					alert(data.msg);
				}
			},
			error:function(data) {
				alert("上传失败")
			}
		})
	}
	function sut(){
		var user = {
			"userId":$("#uid").val(),
			"picture":$("#pName").val()
		}
		$.ajax({
			url:'/admin/updatesuperPicture',
			/* type:"post", */
			data:user,
			success:function(data){
				alert(data);

			},
			error:function(data) {
				alert("操作失败")

			}
		})
	}

</script>
</html>